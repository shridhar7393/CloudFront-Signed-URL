
# CloudFront-Signed-URL


## Repository contents

This repository contains the project to fetch CloudFront Signed URL.


## Welcome

The project CloudFront-Signed-URL contains following tasks:
- Makes an api call to the cloudfront distribution to obtain a signed URL with expiry time of 5 minutes, to the image file uploaded on S3,
- Logs this URL on the console.<br />
*Note: If this signed URL is copy-pasted on a browser, one must be able to view the image file. After 5 minutes, on reload, the same link should stop showing the image and must instead lead to an access-denied page.*




## Installation pre-requisites

For running this project we need Node and npm installed on our machine. These are some tutorials to install node in different operating systems:

- [Install Node and NPM on Windows](https://www.youtube.com/watch?v=8ODS6RM6x7g)
- [Install Node and NPM on Linux](https://www.youtube.com/watch?v=yUdHk-Dk_BY)
- [Install Node and NPM on Mac](https://www.youtube.com/watch?v=Imj8PgG3bZU)

Project requires the following prestart tasks to be completed.

- [Create a private S3 bucket](https://youtu.be/lRD0Kka7y1g). 
- [Upload a file on that S3 bucket](https://youtu.be/wpbIzC8zpc0). 
- [Create a cloudfront distribution which has the above S3 bucket as origin](https://youtu.be/kbI7kRWAU-w). 

1. Run the following commands in your terminal to generate rsa 2048 private and public keys.

***
      openssl req -newkey rsa:2048 -nodes -keyout private_key.pem   //generates new private key 

      openssl rsa -pubout -in private_key.pem -out public_key.pem   //generates new public key from above private key 

***

2. Save the private key in your system. Copy the public key and paste in CloudFront, as shown below.


3. Create Key Group and add ID of Public Key under choose key. (*this Public Key ID is generated by CloudFront upon creating public key*)


## Running the application

By cloning / downloading the repository, the application will be available in your machine.

These following steps to be followed:

1. Here, we need 3 main details from CloudFront to generate Signed URL from the code.

| Variable | Details  |
|:------------------------|:----------------------------------------------------------------------:|
| CLOUD_FRONT_DOMAIN_NAME  |  CloudFront >> Distributions >> Name(*select your distribution*) <br /> >> General >> Deatils(*section*) "Distribution domain name".    <br /> e.g., "d1abc2d3efghi.cloudfront.net"                |
| S3_OBJECT_KEY | (basically the file name uploaded in S3 with its extension) <br /> e.g., "city-pic.jpg" |
| CLOUD_FRONT_KEY_PAIR_ID | which is the ID of CloudFront >> Public Keys. <br /> e.g., "KIO35YYAK4UJ2"|


2. Here, we are using depedent npm libraries "aws-sdk", "cors"(*optional*), "express", "dotenv"(*optional*).<br />
Run following command to install the dependent node modules
***
     npm install aws-sdk express dotenv --save
***
then,
***

    npm run start   //provided start script is added in package.json  
    node app.js     //else use this command where app.js is starting file
***
***Note:** AWS SDK Javascript is under maintenance. If you are getting error from aws-sdk support as 
***
```console

(node:93456) NOTE: We are formalizing our plans to enter AWS SDK for JavaScript (v2) into maintenance mode in 2023.

Please migrate your code to use AWS SDK for JavaScript (v3).
For more information, check the migration guide at https://a.co/7PzMCcy
(Use `node --trace-warnings ...` to show where the warning was created)

```
***
then, use following command instead just
***

    AWS_SDK_JS_SUPPRESS_MAINTENANCE_MODE_MESSAGE=1 node app.js 

***


3. Hit ```localhost:3000/getImage``` URL on the browser.<br />
&emsp;You will get ```Signed URL generated. Check console for the SignedURL``` as response message on the browser.

4. Now check console log for Signed URL output.
5. Copy the Signed URL from log. Paste and hit the URL on browser.<br />
   &emsp;You can see the image loaded and displayed.<br />
***Wait for 5 minutes...***
6. Now refresh the page.<br/ >
&emsp;You will see the following message displayed on browser instead the actual picture.
```html
<Error>
  <Code>AccessDenied</Code>
  <Message>Access denied</Message>
</Error>
```

Code is working as expected.
# Thank you.


*I would love to hear from you @ shreeheg@gmail.com or on Discussion panel.*


### :computer: Coded with :sparkling_heart: by [Shridhar Hegde](https://github.com/shridhar7393)